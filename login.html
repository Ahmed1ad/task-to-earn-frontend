<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
  <meta charset="UTF-8" />
  <title>TaskToEarn | تسجيل الدخول</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body {
      font-family: 'Cairo', sans-serif;
    }

    /* Animations */
    @keyframes fadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes scaleIn {
      from {
        opacity: 0;
        transform: scale(0.95);
      }

      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    .animate-fade-in {
      animation: fadeIn 0.4s ease-out forwards;
    }

    .animate-slide-up {
      animation: slideUp 0.4s ease-out forwards;
    }

    .animate-scale-in {
      animation: scaleIn 0.3s ease-out forwards;
    }

    .delay-100 {
      animation-delay: 100ms;
    }

    .delay-200 {
      animation-delay: 200ms;
    }

    /* Gradient background animation */
    @keyframes gradientShift {
      0% {
        background-position: 0% 50%;
      }

      50% {
        background-position: 100% 50%;
      }

      100% {
        background-position: 0% 50%;
      }
    }

    .gradient-animated {
      background: linear-gradient(-45deg, #f0fdf4, #dcfce7, #bbf7d0, #86efac);
      background-size: 400% 400%;
      animation: gradientShift 15s ease infinite;
    }
  </style>
</head>

<body class="min-h-screen flex items-center justify-center gradient-animated">

  <div class="bg-white w-full max-w-md rounded-2xl shadow-xl p-8 animate-scale-in border border-gray-100">

    <!-- Logo/Brand -->
    <div class="text-center mb-8 animate-slide-up">
      <div
        class="w-20 h-20 bg-gradient-to-br from-emerald-400 to-green-500 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-10 h-10 text-white">
          <path
            d="M10.464 8.746c.227-.18.497-.311.786-.394v2.795a2.252 2.252 0 01-.786-.393c-.394-.313-.546-.681-.546-1.004 0-.314.151-.68.546-1.004zM12.75 15.662v-2.824c.347.085.664.228.921.421.427.32.579.686.579.991 0 .305-.152.671-.579.991a2.534 2.534 0 01-.921.42z" />
          <path fill-rule="evenodd"
            d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25zM12.75 6a.75.75 0 00-1.5 0v.816a3.836 3.836 0 00-1.72.656c-.89.658-1.29 1.57-1.29 2.59 0 2.613 2.665 3.616 5.068 4.436.96.328 1.157.925 1.157 1.606 0 .53-.254 1.258-1.554 1.258-1.156 0-1.616-.677-1.896-1.066a.75.75 0 00-1.248.868c.51 1.056 1.487 1.637 2.644 1.696v.842a.75.75 0 001.5 0v-.806a3.836 3.836 0 001.72-.656c.89-.658 1.29-1.57 1.29-2.59 0-2.613-2.665-3.616-5.068-4.436-.96-.328-1.157-.925-1.157-1.606 0-.53.254-1.258 1.554-1.258 1.156 0 1.616.677 1.896 1.066a.75.75 0 001.248-.868c-.51-1.056-1.487-1.637-2.644-1.696V6z"
            clip-rule="evenodd" />
        </svg>
      </div>
      <h1 class="text-3xl font-black text-gray-900 mb-2">
        TaskToEarn
      </h1>
      <p id="title" class="text-gray-500 font-semibold">
        تسجيل الدخول إلى حسابك
      </p>
    </div>

    <!-- Form -->
    <div class="space-y-4 animate-slide-up delay-100">
      <!-- Username (Register only) -->
      <div id="usernameField" class="hidden">
        <label class="block text-sm font-semibold text-gray-700 mb-2">اسم المستخدم</label>
        <input id="username" type="text" placeholder="اختر اسم مستخدم فريد"
          class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition" />
      </div>

      <!-- Email -->
      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-2">البريد الإلكتروني</label>
        <input id="email" type="email" placeholder="example@email.com"
          class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition" />
      </div>

      <!-- Password -->
      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-2">كلمة المرور</label>
        <input id="password" type="password" placeholder="••••••••"
          class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition" />
      </div>

      <!-- Action Button -->
      <button id="actionBtn"
        class="w-full py-3.5 bg-gray-900 text-white rounded-xl font-bold shadow-lg hover:bg-emerald-600 hover:shadow-emerald-500/30 active:scale-95 transition-all duration-300 flex items-center justify-center gap-2 mt-6">
        <span>تسجيل دخول</span>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5">
          <path fill-rule="evenodd"
            d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25zm4.28 10.28a.75.75 0 000-1.06l-3-3a.75.75 0 10-1.06 1.06l1.72 1.72H8.25a.75.75 0 000 1.5h5.69l-1.72 1.72a.75.75 0 101.06 1.06l3-3z"
            clip-rule="evenodd" />
        </svg>
      </button>

      <!-- Message -->
      <div id="msg" class="text-center text-red-500 text-sm font-semibold min-h-[18px]"></div>

      <!-- Switch -->
      <div class="text-center text-sm pt-4 border-t border-gray-100">
        <span class="text-gray-500">
          ليس لديك حساب؟
        </span>
        <span id="switchText" class="text-emerald-600 font-bold cursor-pointer hover:text-emerald-700 transition mr-1">
          إنشاء حساب
        </span>
      </div>
    </div>

  </div>

  <script src="main.js"></script>
  <script>
    // Check if already logged in
    if (token) {
      window.location.href = "home.html";
    }

    const title = document.getElementById("title");
    const usernameField = document.getElementById("usernameField");
    const username = document.getElementById("username");
    const email = document.getElementById("email");
    const password = document.getElementById("password");
    const actionBtn = document.getElementById("actionBtn");
    const msg = document.getElementById("msg");
    const switchText = document.getElementById("switchText");

    let isLogin = true;

    // Toggle between login and register
    switchText.onclick = () => {
      isLogin = !isLogin;
      if (isLogin) {
        title.innerText = "تسجيل الدخول إلى حسابك";
        usernameField.classList.add("hidden");
        actionBtn.innerHTML = `
          <span>تسجيل دخول</span>
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5">
            <path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25zm4.28 10.28a.75.75 0 000-1.06l-3-3a.75.75 0 10-1.06 1.06l1.72 1.72H8.25a.75.75 0 000 1.5h5.69l-1.72 1.72a.75.75 0 101.06 1.06l3-3z" clip-rule="evenodd" />
          </svg>
        `;
        switchText.innerText = "إنشاء حساب";
      } else {
        title.innerText = "إنشاء حساب جديد";
        usernameField.classList.remove("hidden");
        actionBtn.innerHTML = `
          <span>إنشاء حساب</span>
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5">
            <path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25zm4.28 10.28a.75.75 0 000-1.06l-3-3a.75.75 0 10-1.06 1.06l1.72 1.72H8.25a.75.75 0 000 1.5h5.69l-1.72 1.72a.75.75 0 101.06 1.06l3-3z" clip-rule="evenodd" />
          </svg>
        `;
        switchText.innerText = "تسجيل دخول";
      }
      msg.innerText = "";
    };

    // Handle form submission
    actionBtn.onclick = async () => {
      const emailVal = email.value.trim();
      const passwordVal = password.value.trim();

      if (!emailVal || !passwordVal) {
        msg.innerText = "يرجى ملء جميع الحقول";
        msg.classList.remove("text-green-500");
        msg.classList.add("text-red-500");
        return;
      }

      if (isLogin) {
        // Login
        try {
          const res = await fetch(`${API}/login`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email: emailVal, password: passwordVal })
          });
          const data = await res.json();

          if (data.status === "success") {
            localStorage.setItem("token", data.token);
            msg.innerText = "تم تسجيل الدخول بنجاح!";
            msg.classList.remove("text-red-500");
            msg.classList.add("text-green-500");
            setTimeout(() => window.location.href = "home.html", 500);
          } else {
            msg.innerText = data.message || "خطأ في تسجيل الدخول";
            msg.classList.remove("text-green-500");
            msg.classList.add("text-red-500");
          }
        } catch (err) {
          msg.innerText = "حدث خطأ، حاول مرة أخرى";
          msg.classList.remove("text-green-500");
          msg.classList.add("text-red-500");
        }
      } else {
        // Register
        const usernameVal = username.value.trim();
        if (!usernameVal) {
          msg.innerText = "يرجى إدخال اسم المستخدم";
          msg.classList.remove("text-green-500");
          msg.classList.add("text-red-500");
          return;
        }

        try {
          const res = await fetch(`${API}/register`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              username: usernameVal,
              email: emailVal,
              password: passwordVal
            })
          });
          const data = await res.json();

          if (data.status === "success") {
            localStorage.setItem("token", data.token);
            msg.innerText = "تم إنشاء الحساب بنجاح!";
            msg.classList.remove("text-red-500");
            msg.classList.add("text-green-500");
            setTimeout(() => window.location.href = "home.html", 500);
          } else {
            msg.innerText = data.message || "خطأ في إنشاء الحساب";
            msg.classList.remove("text-green-500");
            msg.classList.add("text-red-500");
          }
        } catch (err) {
          msg.innerText = "حدث خطأ، حاول مرة أخرى";
          msg.classList.remove("text-green-500");
          msg.classList.add("text-red-500");
        }
      }
    };

    // Allow Enter key to submit
    [email, password, username].forEach(input => {
      input.addEventListener("keypress", (e) => {
        if (e.key === "Enter") actionBtn.click();
      });
    });
  </script>

</body>

</html>