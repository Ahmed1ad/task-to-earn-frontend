<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TaskToEarn | Home</title>

<style>
:root{
  --green:#22c55e;
  --green-dark:#16a34a;
  --bg:#f6fffa;
  --card:#ffffff;
  --text:#0f172a;
  --muted:#64748b;
  --shadow:0 20px 40px rgba(0,0,0,.08);
  --radius:18px;
}

*{box-sizing:border-box;font-family:"Cairo",system-ui,sans-serif}

body{
  margin:0;
  background:linear-gradient(135deg,#ecfdf5,#f0fdfa);
  color:var(--text);
  min-height:100vh;
  padding-bottom:90px;
}

/* HEADER */
header{
  position:sticky;
  top:0;
  background:#fff;
  box-shadow:0 4px 15px rgba(0,0,0,.05);
}

.nav{
  max-width:1100px;
  margin:auto;
  padding:14px 20px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.logo{font-weight:800;color:var(--green-dark)}

.points{
  background:#ecfdf5;
  padding:8px 14px;
  border-radius:999px;
  font-weight:700;
  color:var(--green-dark);
}

/* MAIN */
main{
  max-width:1100px;
  margin:auto;
  padding:25px 20px;
}

.welcome{
  background:linear-gradient(135deg,var(--green),#34d399);
  color:#fff;
  padding:24px;
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  margin-bottom:25px;
}

.section-title{
  margin:20px 0 15px;
}

/* TASKS */
.tasks-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
  gap:20px;
}

.card{
  background:var(--card);
  border-radius:var(--radius);
  padding:22px;
  box-shadow:var(--shadow);
  text-align:center;
  animation:fadeUp .4s ease;
}

.card .icon{font-size:44px}
.card p{color:var(--muted);font-size:14px}

.meta{
  display:flex;
  justify-content:space-between;
  margin:16px 0;
  font-weight:700;
}

.btn{
  width:100%;
  padding:14px;
  border:none;
  border-radius:999px;
  background:var(--green);
  color:#fff;
  font-weight:700;
  cursor:pointer;
}

.btn:disabled{background:#94a3b8}

/* EMPTY */
.empty{
  text-align:center;
  color:var(--muted);
  padding:40px 10px;
}

/* COMPLETED */
.completed-item{
  background:#f0fdf4;
  padding:14px;
  border-radius:14px;
  display:flex;
  justify-content:space-between;
  margin-bottom:10px;
  font-size:14px;
}

.completed-item span{
  color:var(--green-dark);
  font-weight:700;
}

/* BOTTOM NAV */
.bottom-nav{
  position:fixed;
  bottom:0;left:0;right:0;
  background:#fff;
  display:flex;
  justify-content:space-around;
  padding:12px 0;
  box-shadow:0 -4px 15px rgba(0,0,0,.08);
}

.bottom-nav button{
  background:none;border:none;
  font-size:14px;
  color:#64748b;
  cursor:pointer;
}

.bottom-nav .active{
  color:var(--green-dark);
  font-weight:700;
}

@keyframes fadeUp{
  from{opacity:0;transform:translateY(15px)}
  to{opacity:1;transform:none}
}
</style>
</head>

<body>

<header>
  <div class="nav">
    <div class="logo">TaskToEarn</div>
    <div class="points">ğŸ’° <span id="userPoints">0</span></div>
  </div>
</header>

<main>

  <section class="welcome">
    <h2>ğŸ‘‹ Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ</h2>
    <p>Ù†ÙÙ‘Ø° Ø§Ù„Ù…Ù‡Ø§Ù… ÙˆØ§Ø±Ø¨Ø­ Ù†Ù‚Ø§Ø· Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ø³Ø­Ø¨</p>
  </section>

  <!-- NEW TASKS -->
  <section id="newTasksSection">
    <h3 class="section-title">Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</h3>
    <div id="tasksBox" class="tasks-grid"></div>
  </section>

  <!-- COMPLETED TASKS -->
  <section id="completedSection" style="display:none">
    <h3 class="section-title">Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©</h3>
    <div id="completedBox"></div>
  </section>

</main>

<nav class="bottom-nav">
  <button class="active" onclick="showNew(event)">ğŸ†• Ø§Ù„Ù…Ù‡Ø§Ù…</button>
  <button onclick="showCompleted(event)">âœ… Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©</button>
</nav>

<script>
const API="https://task-to-earn.onrender.com";
const token=localStorage.getItem("token");
if(!token)location.href="index.html";

const tasksBox=document.getElementById("tasksBox");
const completedBox=document.getElementById("completedBox");

/* USER */
fetch(API+"/me",{headers:{Authorization:"Bearer "+token}})
.then(r=>r.json())
.then(d=>document.getElementById("userPoints").innerText=d.user.points);

/* LOAD TASKS */
fetch(API+"/tasks/ads",{headers:{Authorization:"Bearer "+token}})
.then(r=>r.json())
.then(d=>{
  if(!d.tasks.length){
    tasksBox.innerHTML=`<div class="empty">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… Ø¬Ø¯ÙŠØ¯Ø© Ø­Ø§Ù„ÙŠÙ‹Ø§</div>`;
    return;
  }

  d.tasks.forEach(t=>{
    tasksBox.innerHTML+=`
    <div class="card" data-id="${t.id}">
      <div class="icon">ğŸ“º</div>
      <h3>${t.title}</h3>
      <p>${t.description||""}</p>
      <div class="meta">
        <span>â± ${t.duration_seconds}s</span>
        <span>ğŸ ${t.reward_points}</span>
      </div>
      <button class="btn"
        onclick="startTask(${t.id}, this.closest('.card'), ${t.reward_points})">
        Ø§Ø¨Ø¯Ø£
      </button>
    </div>`;
  });
});

/* START */
function startTask(id, card, points){
  const btn=card.querySelector(".btn");
  btn.disabled=true;
  btn.innerText="â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙ†ÙÙŠØ°";

  fetch(API+"/tasks/ads/start/"+id,{
    method:"POST",
    headers:{Authorization:"Bearer "+token}
  })
  .then(()=>setTimeout(()=>completeTask(id,card,points),5000));
}

/* COMPLETE */
function completeTask(id, card, points){
  fetch(API+"/tasks/ads/complete/"+id,{
    method:"POST",
    headers:{Authorization:"Bearer "+token}
  })
  .then(r=>r.json())
  .then(d=>{
    if(d.status!=="success")return;

    card.remove();

    if(!tasksBox.children.length){
      tasksBox.innerHTML=`<div class="empty">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… Ø¬Ø¯ÙŠØ¯Ø© Ø­Ø§Ù„ÙŠÙ‹Ø§</div>`;
    }

    completedBox.insertAdjacentHTML("afterbegin",`
      <div class="completed-item">
        <div>ğŸ“º Ù…Ù‡Ù…Ø© ${id}</div>
        <span>+${points}</span>
      </div>
    `);

    document.getElementById("userPoints").innerText =
      parseInt(document.getElementById("userPoints").innerText) + points;
  });
}

/* NAV */
function showCompleted(e){
  document.getElementById("newTasksSection").style.display="none";
  document.getElementById("completedSection").style.display="block";
  document.querySelectorAll(".bottom-nav button").forEach(b=>b.classList.remove("active"));
  e.target.classList.add("active");
}

function showNew(e){
  document.getElementById("completedSection").style.display="none";
  document.getElementById("newTasksSection").style.display="block";
  document.querySelectorAll(".bottom-nav button").forEach(b=>b.classList.remove("active"));
  e.target.classList.add("active");
}
</script>

</body>
</html>